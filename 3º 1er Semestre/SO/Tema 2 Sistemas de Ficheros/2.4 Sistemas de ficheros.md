- **2.4.1 Conceptos** 
	- Permite organizar varios ficheros y carpetas
	- Permite abrir, cerrar y modificar dichos ficheros
	- Existe una interfaz común entre todos los tipos de ficheros
	- El VFS construye abstracciones de objetos que usa el kernel para manipular ficheros
	

- **2.4.2 VFS**
	- 
	 ![[Pasted image 20251009113906.png]] 

	- Entradas de Directorio:
		- Elementos de una ruta
		- Cada dentry tiene su inodo asociado así como sus metadatos
		- Las dentry se guardan en memoria para acelerar el acceso
		- Cache negativas (guarda rutas inexistentes)
		
	- Inodos:
		- Guarda información genérica del inodo para cada SF
		- El inodo se construye a partir de la información del inodo de SF
		- Se guardan en memoria
		
	- SuperBloques:
		- Representan la información global de un sistema de ficheros montado
		- Corresponden a un bloque de control del SF
	
	- Ficheros:
		- Representación en memoria de un fichero abierto
		- Contiene las instrucciones del SF que les permiten ser manipulados
		- Diferentes ficheros pueden ir al mismo archivo
		- Puntero al fichero (según vaya leyendo este puntero va cambiando como en c++)
		- ![[Pasted image 20251009115143.png]]

- **2.4.3 Gestión de Bloques**
	- Asignación:
		- Localidad Espacial: Mantener los datos del fichero para mejorar el rendimiento
			- Discos mecánicos, menos lectura
			- SSD, realiza menos operaciones
		- Fragmentación:
			- Externa: El espacio libre se fragmenta en huecos pequeños y contiguos al disco
			- Interna: Espacio no utilizado dentro de un bloque del disco
			- ![[Pasted image 20251009115650.png]]
			
	- Estrategias para mitigar la fragmentación:
		- Extents: Se tienen grupos de bloques contiguos en lugar de usar bloques  individuales en la gestión (BLOQUE INICIAL + TAMAÑO) EJ diapo 28
		- Asignación retardada: Los bloques se asignan cuando los datos tienen que escribirse en el disco
		- Preasignación de bloques:
			- Da más bloques de los solicitados
			- Reserva bloques contiguos para un fichero *fallocate(2)* 
			
	-  Asignación Contigua:
		- Los bloques se asignan de forma contigua
		- Acceso sencillo y secuencial
		- Fragmentación externa
		- Se usa en medios de solo lectura con tamaños conocidos en los ficheros NO EN OTRAS COSAS
		- Ej: ROM
		
	- Bloques Enlazados:
	
		- Los bloques que constituyen el fichero se almacenan como una lista enlazada
		- No hay fragmentación externa
		- Asignación dinámica simple pero sin locaclidd
		- La tabla FAT es un único punto de fallo
		- Se usa en los USBS
		- El acceso a un byte en el fichero consiste en determinar el bloque en el que se encuentra y recorrer la lista
		- ![[Pasted image 20251009122034.png]]
	
	- Bloques Indexados:
		- Los bloques se indexan en uno o más niveles
		- Se reduce la fragmentación externa
		- Acceso muy eficiente para ficheros pequeños
		- Operaciones de borrado ineficientes para ficheros grandes
		- Aplicación: sistemas de ficheros de propósito general
			- Bloque que almacena punteros a otro bloque que almacena a su vez los directorios
		-  
			![[Pasted image 20251009122837.png]]
		- PARA SACAR EL TAMAÑO MÁXIMO:
			- 1º Sacamos el tamaño de I (Tbloque / Tindicie) 
			- 2º Aplicamos la suma de D + I + I^2 + I^3  siendo D el número de TBloque ** Tindidice e I el tamaño de I
			
	-  Árboles Balanceados de Bloques B+tree:
		- Son árboles balanceados
		- Los datos se almacenan en las hojas
		- La raíz y los nodos intermedios son claves
		- Estos árboles tienen un tamaño reducido
		- Se usan extents en lugar de bloques individuales
		- Se guardan en árboles con profundidad reducida
		- Gestión eficiente para ficheros grandes
		- Se usa en los SF actuales
		- Los 4 primeros extents se pueden guardar en ek primer i-nodo ya que cada 1 tiene espacio para 4 extents
		- Diapos 34 y 35
		
		- Ejemplo:
			- Árbol de grado 4
			- Quiero insertar los bloques en 2,3,5,11 y 17 (guardamos pares, bloque lógico con bloque físico, los números son la clave (lógico virtual) y vienen acompañada de un dato (físico))
			- Los elementos se van insertando en orden, y a la que se van desequilibrando se Equilibran solas (Árboles equilibrados de Marp), importante el nodo raíz se coloca en las hojas de la derecha, ya que si no no se puede acceder a él
			
	-  Ficheros Dispersos:
		- Son ficheros parcialmente vacíos
		- El sistema de ficheros no lee ni escribe estos bloques del disco
		- Implementación:
			- Bloques indexados: Solo se inicializan los índices necesarios para los bloques usados
			- Extents: Los extents que se corresponden con estas regiones no están presentes
		- ![[Pasted image 20251010113515.png]] 